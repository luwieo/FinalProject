<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Analytics | Urbiztondo Admin Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #f8f9fa;
    }
    .badge-success { background-color: #198754; }
    .badge-warning { background-color: #ffc107; color: black; }
    .badge-danger { background-color: #dc3545; }
    .card-hover:hover { box-shadow: 0 0 15px rgba(0,0,0,0.1); transition: 0.3s; cursor: pointer; }
    .search-input { max-width: 300px; }
    .chart-container {
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
    }
    .section { display: none; }
    .section.active { display: block; }
  </style>
</head>
<body>
  <div class="container-fluid p-4">
    <!-- Summary Cards -->
    <div class="row mb-4 text-center">
      <div class="col-md-4">
        <div class="card card-hover p-3" onclick="showSection('overallSection')">
          <h5>Overall Data</h5>
          <p>View Overall Data</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-hover p-3" onclick="showSection('servicesSection')">
          <h5>Services</h5>
          <p>View all Services Request</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-hover p-3" onclick="showSection('complaintsSection')">
          <h5>Complaints</h5>
          <p>View all Complaints</p>
        </div>
      </div>
    </div>

    <!-- Overall Data Section -->
    <div id="overallSection" class="section active">
      <!-- Chart + Export -->
      <div class="row mb-4">
        <div class="col-12 d-flex justify-content-center">
          <div class="chart-container bg-white rounded shadow-sm text-center">
            <canvas id="dataChart" style="max-width: 100%; height: 250px;"></canvas>
          </div>
        </div>
        <div class="col-12 text-end mt-3">
          <button class="btn btn-success" onclick="exportToCSV()">Download CSV</button>
        </div>
      </div>

      <!-- Table -->
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="card-title mb-0">Citizen Applications</h5>
            <input type="text" id="searchInput" class="form-control search-input" placeholder="Search...">
          </div>
          <table class="table table-bordered table-striped">
            <thead class="table-primary">
              <tr>
                <th>Citizen Name</th>
                <th>Address</th>
                <th>Application Type</th>
                <th>App No.</th>
                <th>Date Submitted</th>
                <th>Duration</th>
                <th>Last Updated</th>
                <th>Status</th>
                <th>Remarks</th>
                <th>View</th>
              </tr>
            </thead>
            <tbody id="dataTable">
              <tr>
                <td>Mylene Esquilona</td>
                <td>Blk 1 Lot 1</td>
                <td>Birth Certificate</td>
                <td>S-12345</td>
                <td>05-18-2025</td>
                <td>23 days ago</td>
                <td>05-28-2025</td>
                <td><span class="badge badge-success">Completed</span></td>
                <td>Approved</td>
                <td><button class="btn btn-sm btn-primary">View</button></td>
              </tr>
              <tr>
                <td>Jana Soriano</td>
                <td>Blk 5 Lot 11</td>
                <td>Business Permit</td>
                <td>S-12346</td>
                <td>05-22-2025</td>
                <td>19 days ago</td>
                <td>05-23-2025</td>
                <td><span class="badge badge-warning">Pending</span></td>
                <td>Approved</td>
                <td><button class="btn btn-sm btn-primary">View</button></td>
              </tr>
              <tr>
                <td>Kim Napatutan</td>
                <td>Purok 3, San Juan</td>
                <td>Barangay Clearance</td>
                <td>S-12347</td>
                <td>05-20-2025</td>
                <td>21 days ago</td>
                <td>06-01-2025</td>
                <td><span class="badge badge-danger">Declined</span></td>
                <td>Incomplete Requirements</td>
                <td><button class="btn btn-sm btn-primary">View</button></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Services Section -->
    <div id="servicesSection" class="section">
      <div class="card">
        <div class="card-body">
          <h5>Services Request Overview</h5>
          <p>View and manage all submitted service requests by citizens.</p>
          <ul>
            <li>Barangay Clearance</li>
            <li>Business Permit</li>
            <li>Residency Certificate</li>
            <li>ID Issuance</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Complaints Section -->
    <div id="complaintsSection" class="section">
      <div class="card">
        <div class="card-body">
          <h5>Citizen Complaints</h5>
          <p>Below is a list of recent complaints submitted by citizens:</p>
          <ul>
            <li>Broken streetlights in Purok 4 - Submitted 2 days ago</li>
            <li>Garbage collection delay in Zone 2 - Submitted 5 days ago</li>
            <li>No water in Sitio Malusak - Submitted 1 week ago</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart Script -->
  <script>
    const ctx = document.getElementById("dataChart").getContext("2d");
    new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: ["Birth Certificate", "Business Permit", "Barangay Clearance", "ID Request", "Residency Cert", "Others"],
        datasets: [{
          data: [3, 2, 1, 1, 2, 1],
          backgroundColor: ["#0d6efd", "#198754", "#ffc107", "#dc3545", "#6f42c1", "#0dcaf0"]
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: "bottom" },
          title: {
            display: true,
            text: "Overall Data Distribution"
          }
        }
      }
    });

    function showSection(sectionId) {
      const sections = document.querySelectorAll('.section');
      sections.forEach(sec => sec.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
    }

    function exportToCSV() {
      const rows = document.querySelectorAll("table tr");
      let csv = "";

      rows.forEach(row => {
        const cols = row.querySelectorAll("td, th");
        const data = Array.from(cols).map(col => `"${col.innerText}"`).join(",");
        csv += data + "\n";
      });

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "urbiztondo_report_data.csv";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    document.getElementById("searchInput").addEventListener("keyup", function () {
      const value = this.value.toLowerCase();
      const rows = document.querySelectorAll("#dataTable tr");
      rows.forEach(row => {
        row.style.display = row.innerText.toLowerCase().includes(value) ? "" : "none";
      });
    });
  </script>
</body>
</html>
